# =============================================================================
# Sea Route Gateway - Application Configuration
# =============================================================================
# Properties below will be populated in later steps.
# =============================================================================

# Server
# server:
#   port: 8080

# Spring Cloud Gateway
# spring:
#   cloud:
#     gateway:
#       routes: []
#       default-filters: []

# Eureka Client (service discovery)
# eureka:
#   client:
#     service-url:
#       defaultZone: http://localhost:8761/eureka/
#   instance:
#     prefer-ip-address: true

# Redis (rate limiting and caching)
# spring:
#   data:
#     redis:
#       host: localhost
#       port: 6379

# Actuator
# management:
#   endpoints:
#     web:
#       exposure:
#         include: health,info,gateway
#   endpoint:
#     health:
#       show-details: when-authorized

# Application name (for Eureka registration)
# spring:
#   application:
#     name: sea-route-gateway

# Logging: JSON output is configured in logback-spring.xml via logstash-logback-encoder.
# logging:
#   level:
#     com.searoute.gateway: INFO
#     org.springframework.cloud.gateway: INFO

# -----------------------------------------------------------------------------
# JWT (OAuth2 Resource Server) - for gateway authentication
# -----------------------------------------------------------------------------
# Issuer URI: used to validate the JWT "iss" claim and to discover the JWK Set
# (OpenID Connect discovery). For development, use a test issuer such as Keycloak.
spring:
  # Redis: used by the gateway for distributed rate limiting (token bucket).
  data:
    redis:
      host: localhost
      port: 6379
  # Request rate limiter: add X-RateLimit-* headers to responses for client visibility.
  cloud:
    gateway:
      filter:
        request-rate-limiter:
          include-headers: true
  security:
    oauth2:
      resourceserver:
        jwt:
          # Development: Keycloak realm issuer (adjust port if your IdP runs elsewhere).
          issuer-uri: http://localhost:8080/auth/realms/searoute
          # Optional: override JWK Set URI if discovery is not used (e.g. same host as issuer).
          # jwk-set-uri: http://localhost:8080/auth/realms/searoute/protocol/openid-connect/certs

# -----------------------------------------------------------------------------
# Resilience4j Circuit Breaker (used by ReactiveCircuitBreakerFactory)
# -----------------------------------------------------------------------------
# Instance names must match the string passed to factory.create("name") in each proxy:
#   bookingService, trackingService, scheduleService.
# Spring Cloud Circuit Breaker auto-configuration binds these properties and
# ReactiveResilience4JCircuitBreakerFactory uses them when create(instanceName) is called.
resilience4j:
  circuitbreaker:
    instances:
      bookingService:
        slidingWindowSize: 10
        failureRateThreshold: 50
        waitDurationInOpenState: 10s
        minimumNumberOfCalls: 5
        permittedNumberOfCallsInHalfOpenState: 3
      trackingService:
        slidingWindowSize: 10
        failureRateThreshold: 50
        waitDurationInOpenState: 10s
        minimumNumberOfCalls: 5
        permittedNumberOfCallsInHalfOpenState: 3
      scheduleService:
        slidingWindowSize: 10
        failureRateThreshold: 50
        waitDurationInOpenState: 10s
        minimumNumberOfCalls: 5
        permittedNumberOfCallsInHalfOpenState: 3

# -----------------------------------------------------------------------------
# Backend service base URLs (for WebClient proxies)
# -----------------------------------------------------------------------------
# When using Eureka, these can be replaced with lb://BOOKING-SERVICE etc. via discovery.
searoute:
  backend:
    booking-base-url: http://localhost:8081
    tracking-base-url: http://localhost:8082
    schedule-base-url: http://localhost:8083
